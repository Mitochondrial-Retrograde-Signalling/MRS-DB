(this["webpackJsonparabidopsis-reactjs"]=this["webpackJsonparabidopsis-reactjs"]||[]).push([[0],{36:function(e,t,a){e.exports=a(80)},43:function(e,t,a){},80:function(e,t,a){"use strict";a.r(t);var l=a(0),n=a.n(l),r=a(30),o=a.n(r),s=(a(43),a(15)),i=a(31),c=a.n(i),m=a(35),h=(a(54),a(3)),p=a(34),d=a(14),u=a(32);function g(){const[e,t]=Object(l.useState)({}),[a,r]=Object(l.useState)([]),[o,i]=Object(l.useState)(null),[p,g]=Object(l.useState)([]),[f,y]=Object(l.useState)([]),[v,b]=Object(l.useState)([]),[x,E]=Object(l.useState)([0,0]),[w,S]=Object(l.useState)({}),[j,O]=Object(l.useState)([]),[k,C]=Object(l.useState)([]),[L,z]=Object(l.useState)([]),[I,N]=Object(l.useState)([]),[G,B]=Object(l.useState)({}),[W,M]=Object(l.useState)(!1),[R,T]=Object(l.useState)({}),F=Object(h.l)(),P=Object(h.n)(),A=Object(l.useRef)(!1),D={"Companion cell":"Companion<br>cell",Epidermis:"Epi-<br>dermis","G2/M phase":"G2/m<br>phase","Leaf guard cell":"Leaf<br>guard<br>cell","Leaf pavement cell":"Leaf<br>pave-<br>mentcell",Mesophyll:"Meso<br>phyll","Phloem parenchyma":"Phloem<br>paren-<br>chyma","S phase":"S phase",Unknown:"Unknown",Xylem:"Xylem"};Object(l.useEffect)(()=>{const e=()=>M(window.scrollY>300);return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),Object(l.useEffect)(()=>{const e=["1h.json","3h.json","6h.json"];Promise.all(e.map(e=>fetch("/data/processed/"+e).then(e=>e.json()))).then(a=>{const l={},n=new Set,o={},s=new Set,i=new Set,c={},m={};e.forEach((e,t)=>{const r=a[t],h=r.Timepoint+"h";c[h]=!0,l[h]=r.GeneList,Object.entries(r.GeneList).forEach(e=>{let[t,a]=e;n.add(t),o[t]||(o[t]=new Set),m[t]||(m[t]={}),Object.entries(a).forEach(e=>{var a;let[l,n]=e;o[t].add(l);const r=(null===n||void 0===n||null===(a=n.Details)||void 0===a?void 0:a.GeneName)||"",c=r?`${l} (${r})`:l;m[t][l]={id:l,name:r,label:c},Object.entries(n).forEach(e=>{let[t,a]=e;"Details"!==t&&(i.add(t),Object.keys(a||{}).forEach(e=>{s.add(e)}))})})})});const h=Object.keys(c).map(e=>parseInt(e)).sort((e,t)=>e-t);t(l),b(h),E([h[0],h[h.length-1]]),r(Array.from(n).sort()),S(o),T(m),O(Array.from(s).sort()),z(Array.from(i).sort())})},[]),Object(l.useEffect)(()=>{if(o&&w[o]){const e=R[o]||{},t=Object.values(e).map(e=>{let{id:t,label:a}=e;return{value:t,label:a||t}});g(t),y([])}},[o,w,R]),Object(l.useEffect)(()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},150)},[f,o,I,k]),Object(l.useEffect)(()=>{var e,t,l;if(0===a.length||0===L.length||0===j.length||0===v.length||0===Object.keys(w).length)return;if(A.current)return void(A.current=!1);const n=new URLSearchParams(F.search),r=n.get("geneList")||a[0],o=(null===(e=n.get("cellTypes"))||void 0===e?void 0:e.split(","))||[j[0]],s=(null===(t=n.get("genotypes"))||void 0===t?void 0:t.split(","))||[L[0]],c=null===(l=n.get("tpRange"))||void 0===l?void 0:l.split(",").map(Number),m=2!==(null===c||void 0===c?void 0:c.length)||c.includes(NaN)?[v[0],v[v.length-1]]:c;i(r),C(o),N(s),E(m)},[F.search,a,L,j,w,v]),Object(l.useEffect)(()=>{var e;const t=((null===(e=new URLSearchParams(F.search).get("genes"))||void 0===e?void 0:e.split(","))||[]).filter(e=>p.includes(e));t.length&&y(t)},[p,F.search]),Object(l.useEffect)(()=>{if(!o||0===f.length||0===I.length||0===k.length||0===x[0]&&0===x[1])return;const e=new URLSearchParams;o&&e.set("geneList",o),f.length&&e.set("genes",f.join(",")),I.length&&e.set("genotypes",I.join(",")),k.length&&e.set("cellTypes",k.join(",")),2===x.length&&e.set("tpRange",x.join(","));const t=e.toString();t!==(F.search.startsWith("?")?F.search.substring(1):F.search)&&(A.current=!0,P({search:t},{replace:!0}))},[o,f,I,k,x,P,F.search]);return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{style:{position:"sticky",top:0,backgroundColor:"#f8f9fa",zIndex:100,padding:"1rem 3rem 1.5rem 3rem",borderBottom:"1px solid #ccc",width:"100%"}},n.a.createElement("div",{style:{width:"100%",marginBottom:"1rem"}},n.a.createElement("h2",{style:{margin:0}},"Arabidopsis Gene Expression Explorer")),n.a.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:"2rem",alignItems:"flex-start"}},n.a.createElement("div",{style:{maxWidth:"150px",flex:"1 1 240px"}},n.a.createElement("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",marginBottom:"0.5rem"}},n.a.createElement("strong",null,"Gene List"),n.a.createElement("span",{title:"Select a Gene List to explore gene expression.",style:{marginLeft:"8px",cursor:"help",fontSize:"1rem",color:"#666"}},"\u2139\ufe0f")),n.a.createElement("div",{style:{height:56}},n.a.createElement(s.a,{options:a.map(e=>({value:e,label:e})),value:o?{value:o,label:o}:null,onChange:e=>i((null===e||void 0===e?void 0:e.value)||null),placeholder:"Search Gene List...",isSearchable:!0,styles:{container:e=>({...e,width:"100%"})}}))),n.a.createElement("div",{style:{maxWidth:"220px",flex:"1 1 240px"}},n.a.createElement("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",marginBottom:"0.5rem"}},n.a.createElement("strong",null,"Genotypes"),n.a.createElement("span",{title:"Compare gene expression across selected genotypes.",style:{marginLeft:"8px",cursor:"help",fontSize:"1rem",color:"#666"}},"\u2139\ufe0f")),n.a.createElement(s.a,{isMulti:!0,options:L.map(e=>({value:e,label:e})),value:I.map(e=>({value:e,label:e})),onChange:e=>N((e||[]).map(e=>e.value)),placeholder:"Select genotypes",closeMenuOnSelect:!1,isSearchable:!0,styles:{container:e=>({...e,width:"100%"}),valueContainer:e=>({...e,maxHeight:80,overflowY:"auto",flexWrap:"wrap"}),menu:e=>({...e,zIndex:9999})}})),n.a.createElement("div",{style:{maxWidth:"230px",flex:"1 1 240px"}},n.a.createElement("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",marginBottom:"0.5rem"}},n.a.createElement("strong",null,"Genes"),n.a.createElement("span",{title:"Choose one or more genes from the selected geneList.",style:{marginLeft:"8px",cursor:"help",fontSize:"1rem",color:"#666"}},"\u2139\ufe0f")),n.a.createElement("div",{style:{height:120,display:"flex",alignItems:"stretch"}},console.log("Gene options:",p),n.a.createElement(s.a,{isMulti:!0,options:(p||[]).map(e=>"string"===typeof e?{value:e,label:e}:e),value:f.map(e=>p.find(t=>t.value===e)||{value:e,label:e}),onChange:e=>y((e||[]).map(e=>e.value)),filterOption:(e,t)=>Object(u.a)([e],t,{keys:["label"]}).length>0,placeholder:"Select genes",isSearchable:!0,isDisabled:!o,styles:{container:e=>({...e,width:"100%"}),control:e=>({...e,minHeight:120,height:120,alignItems:"flex-start"}),valueContainer:e=>({...e,maxHeight:80,overflowY:"auto",flexWrap:"wrap"}),menu:e=>({...e,zIndex:9999})}}))),n.a.createElement("div",{style:{maxWidth:"240px",flex:"1 1 240px"}},n.a.createElement("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",marginBottom:"0.5rem"}},n.a.createElement("strong",null,"Cell Types"),n.a.createElement("span",{title:"Filter by specific cell types to focus your analysis.",style:{marginLeft:"8px",cursor:"help",fontSize:"1rem",color:"#666"}},"\u2139\ufe0f")),n.a.createElement("div",{style:{height:120,display:"flex",alignItems:"stretch"}},n.a.createElement(s.a,{isMulti:!0,options:j.map(e=>({value:e,label:e})),value:k.map(e=>({value:e,label:e})),onChange:e=>C((e||[]).map(e=>e.value)),placeholder:"Select cell types",closeMenuOnSelect:!1,isSearchable:!0,styles:{container:e=>({...e,width:"100%"}),control:e=>({...e,minHeight:120,height:120,alignItems:"flex-start"}),valueContainer:e=>({...e,maxHeight:80,overflowY:"auto",flexWrap:"wrap"}),menu:e=>({...e,zIndex:9999})}}))),v.length>1&&n.a.createElement("div",{style:{maxWidth:"280px",flex:"1 1 240px"}},n.a.createElement("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",marginBottom:"0.5rem"}},n.a.createElement("strong",null,"Timepoint"),n.a.createElement("span",{title:"Select a range of timepoints to display plots.",style:{marginLeft:"8px",cursor:"help",fontSize:"1rem",color:"#666"}},"\u2139\ufe0f")),n.a.createElement(m.a,{range:!0,min:v[0],max:v[v.length-1],value:x,onChange:e=>E(e),marks:v.reduce((e,t)=>(e[t]=t.toString(),e),{}),step:null,allowCross:!1,style:{width:"100%"}})))),n.a.createElement("div",{style:{padding:"1rem",paddingLeft:"5vw"}},v.filter(e=>e>=x[0]&&e<=x[1]).map(t=>(t=>{var a;const l=t+"h",r=null===(a=e[l])||void 0===a?void 0:a[o];if(!r)return null;const s=new Set;f.forEach(e=>{const t=r[e];t&&I.forEach(e=>{const a=t[e]||{};k.forEach(e=>{const t=a[e]||{};Object.keys(t).forEach(t=>{t.startsWith("log2FC")&&s.add(`${e}||${t}`)})})})});const i=Array.from(s).sort(),m=i.map(e=>e.split("||")[1].replace("log2FC_","")),h=50*m.length+400,p=50*f.length*I.length+200,u=[],g=[],y=[],v=[];f.forEach(e=>{I.forEach(t=>{u.push(`${e} - ${t}`);const a=[],l=[],n=[];i.forEach(o=>{var s,i,c;const[m,h]=o.split("||"),p=null===(s=r[e])||void 0===s||null===(i=s[t])||void 0===i||null===(c=i[m])||void 0===c?void 0:c[h];"ns"===p?(a.push(NaN),l.push(1),n.push("ns")):void 0===p||null===p?(a.push(null),l.push(1),n.push("No data")):(a.push(parseFloat(p)),l.push(0),n.push(p))}),g.push(a),y.push(l),v.push(n)})});const b=[],x=[];for(let e=0;e<f.length;e++){const t=e*I.length,a=t+I.length-1;b.push({type:"rect",xref:"x",yref:"y",x0:-.5,x1:m.length-.5,y0:t-.5,y1:a+.5,line:{color:"white",width:2},layer:"above",fillcolor:"rgba(0,0,0,0)"})}const E={};i.forEach((e,t)=>{const[a]=e.split("||");E[a]||(E[a]=[]),E[a].push(t)}),Object.entries(E).forEach(e=>{let[t,a]=e;const l=Math.min(...a),n=Math.max(...a),r=1===a.length&&D[t]?D[t]:t;b.push({type:"rect",xref:"x",yref:"y",x0:l-.5,x1:n+.5,y0:u.length-.5+.2,y1:u.length-.5+1.2,fillcolor:"#bfbaba",line:{color:"white",width:2},layer:"below"}),x.push({x:(l+n)/2,y:u.length-.5+.7,xref:"x",yref:"y",text:r,showarrow:!1,font:{size:9,color:"#333"},align:"center"}),l>0&&b.push({type:"line",x0:l-.5,x1:l-.5,y0:-.5,y1:u.length-.5,xref:"x",yref:"y",line:{color:"white",width:2},layer:"above"})});const w=0===g.length||g.flat().every(e=>null===e||Number.isNaN(e));if(!m.length||!u.length||!g.length||w)return n.a.createElement("div",{id:"plot-"+l,key:l,style:{marginBottom:"3rem"}},n.a.createElement("h3",null,l),n.a.createElement("div",{style:{marginBottom:"0.5rem",color:"#666",fontStyle:"italic"}},"All values are not statistically significant or missing. No heatmap rendered."));const S=!1!==G[l];return n.a.createElement("div",{id:"plot-"+l,key:l,style:{marginBottom:"3rem"}},n.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"2rem",flexWrap:"wrap"}},n.a.createElement("div",{style:{display:"flex",alignItems:"center",gap:"1rem"}},n.a.createElement("h3",{style:{margin:0}},l,n.a.createElement("span",{title:"This heatmap shows log\u2082 fold change. Gray tiles represent 'ns' (not statistically significant) or No data.",style:{marginLeft:"8px",cursor:"help",fontSize:"1rem",color:"#666"}},"\u2139\ufe0f")),n.a.createElement("button",{onClick:()=>{B(e=>({...e,[l]:!S}))},style:{fontSize:"0.85rem"}},S?"Hide":"Show")),n.a.createElement("button",{onClick:()=>{var a;const l=t+"h",n=null===(a=e[l])||void 0===a?void 0:a[o];if(!n)return;const r={},s=[];[...k].sort().forEach(e=>{const t=new Set;f.forEach(a=>{I.forEach(l=>{var r,o;const s=null===n||void 0===n||null===(r=n[a])||void 0===r||null===(o=r[l])||void 0===o?void 0:o[e];s&&Object.keys(s).forEach(e=>t.add(e))})});const a=Array.from(t).sort();r[e]=a,a.forEach(t=>s.push([e,t]))});const i=["Gene","Genotype",...s.map(e=>{let[t]=e;return t})],c=["","",...s.map(e=>{let[t,a]=e;return a})],m=[];let h=2;for(const[e,t]of Object.entries(r)){const e=t.length;e>1&&m.push({s:{r:0,c:h},e:{r:0,c:h+e-1}}),h+=e}const p=[];f.forEach(e=>{I.forEach(t=>{const a=[e,t];s.forEach(l=>{var r,o,s;let[i,c]=l;const m=null===n||void 0===n||null===(r=n[e])||void 0===r||null===(o=r[t])||void 0===o||null===(s=o[i])||void 0===s?void 0:s[c];a.push(void 0===m||null===m||Number.isNaN(m)?"No Data":m)}),p.push(a)})});const u=[i,c,...p],g=d.a.aoa_to_sheet(u);g["!merges"]=m;const y=d.a.book_new();d.a.book_append_sheet(y,g,"Sheet1"),d.b(y,l+"_data.xlsx")},style:{marginLeft:"auto",marginRight:"2rem",padding:"0.4rem 0.8rem",backgroundColor:"#3276db",color:"white",border:"none",borderRadius:"4px",fontSize:"0.9rem",cursor:"pointer"}},"Download ",l," Data")),S&&n.a.createElement(c.a,{useResizeHandler:!1,style:{width:h+"px",height:p+"px"},data:[{z:g,x:m.map((e,t)=>t),y:u.map((e,t)=>t),type:"heatmap",colorscale:[[0,"blue"],[.5,"white"],[1,"red"]],zmid:0,showscale:!0,colorbar:{title:{text:"log\u2082 Fold Change",side:"right",font:{size:12,weight:"bold"}}},hovertext:v,hovertemplate:"%{y}<br>%{x}: %{hovertext}<extra></extra>"},{z:y,x:m.map((e,t)=>t),y:u.map((e,t)=>t),type:"heatmap",colorscale:[[0,"rgba(0,0,0,0)"],[1,"#d3d3d3"]],showscale:!1,hoverinfo:"skip",opacity:1}],layout:{width:h,height:p,margin:{l:180,r:30,t:40,b:140},yaxis:{tickvals:u.map((e,t)=>t),ticktext:u,automargin:!0,dtick:1,constrain:"domain",ticks:""},xaxis:{tickvals:m.map((e,t)=>t),ticktext:m,tickangle:-60,tickfont:{size:12},automargin:!0,constrain:"domain",ticks:"",showline:!1,showgrid:!1,zeroline:!1},shapes:b,annotations:x},config:{responsive:!0}}))})(t)),W&&n.a.createElement("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),style:{position:"fixed",bottom:"30px",right:"30px",zIndex:1e3,padding:"0.6rem 0.95rem",fontSize:"1.5rem",borderRadius:"50%",backgroundColor:"#007bff",color:"white",border:"none",boxShadow:"0 2px 6px rgba(0,0,0,0.2)",cursor:"pointer"}},"\u2b9d")))}function f(){return n.a.createElement(p.a,null,n.a.createElement(g,null))}var y=e=>{e&&e instanceof Function&&a.e(3).then(a.bind(null,81)).then(t=>{let{getCLS:a,getFID:l,getFCP:n,getLCP:r,getTTFB:o}=t;a(e),l(e),n(e),r(e),o(e)})};o.a.createRoot(document.getElementById("root")).render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(f,null))),y()}},[[36,1,2]]]);
//# sourceMappingURL=main.aac8f8b5.chunk.js.map